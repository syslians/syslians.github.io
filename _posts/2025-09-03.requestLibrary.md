## Gather Data from Cisco Routers


<img width="686" height="535" alt="Network" src="https://github.com/user-attachments/assets/142fef0f-b72e-4b13-a8b7-d6bdef022dd8" />

### 장비 정보
|Device|Device Description|IP Address|Credentials|
|------|---|---|
|Student Workstaion|Linux Ubuntu VM||student, cisco|
|R1|Cisco Catalyst 8000V Edge Router|10.254.0.1|cisco, cisco|
|R2|Cisco Catalyst 800V Edge Router|10.254.0.2|cisco, cisco|
|R3|Cisco Catalyst 800V Edge Router|10.254.0.3|cisco, cisco|


```python
#!/usr/bin/env python

import requests
import json
import sys
from requests.auth import HTTPBasicAuth

# Disable warnings for development purposes only
requests.packages.urllib3.disable_warnings()

# Constants
HTTP_HEADERS = {
    "Content-Type": "application/yang-data+json",
    "Accept": "application/yang-data+json",
}
HTTP_AUTH = HTTPBasicAuth("cisco", "cisco")  # Consider using env variables in production

def get_inventory():
    """Return a hardcoded inventory of devices."""
    return {
        "r1": {"username": "cisco", "password": "cisco", "host": "r1.example.com"},
        "r2": {"username": "cisco", "password": "cisco", "host": "r2.example.com"},
    }

def get_serial_data(host):
    """Fetch serial number from a device using RESTCONF."""
    url = f"https://{host}/restconf/data/Cisco-IOS-XE-native:native/license/udi/sn"
    try:
        response = requests.get(url, headers=HTTP_HEADERS, auth=HTTP_AUTH, verify=False)
        response.raise_for_status()  # Raise an exception for bad status codes
        data = response.json()
        serial = data.get("Cisco-IOS-XE-native:sn", "N/A")
        print(f"Status Code for {host}: {response.status_code}")
        return serial
    except requests.RequestException as e:
        print(f"Error fetching serial number for {host}: {e}")
        return "Error"
    except json.JSONDecodeError:
        print(f"Invalid JSON response for {host}")
        return "Error"

def get_hostname(host):
    """Fetch hostname from a device using RESTCONF."""
    url = f"https://{host}/restconf/data/Cisco-IOS-XE-native:native/hostname"
    try:
        response = requests.get(url, headers=HTTP_HEADERS, auth=HTTP_AUTH, verify=False)
        response.raise_for_status()
        data = response.json()
        return data.get("Cisco-IOS-XE-native:hostname", "N/A")
    except requests.RequestException as e:
        print(f"Error fetching hostname for {host}: {e}")
        return "Error"
    except json.JSONDecodeError:
        print(f"Invalid JSON response for {host}")
        return "Error"

def structure_data():
    """Structure device data from inventory."""
    devices = {}
    net_inventory = get_inventory()
    for host in net_inventory:
        devices[host] = {
            "serial_number": get_serial_data(net_inventory[host]["host"]),
            "hostname": get_hostname(net_inventory[host]["host"])
        }
    return devices

def main():
    """Main function to fetch and display device data."""
    structured_data = structure_data()

    # Format table
    heading = "| {:^10} | {:^15} | {:^15} |".format("Device", "Hostname", "Serial Number")
    print(len(heading) * "-")
    print(heading)
    print(len(heading) * "-")
    for device, details in structured_data.items():
        print("| {:^10} | {:^15} | {:^15} |".format(
            device, details["hostname"], details["serial_number"]
        ))
    print(len(heading) * "-")

if __name__ == "__main__":
    main()
```
## Cisco IOS XE RESTCONF API를 활용한 네트워크 장비 정보 수집 자동화

현대 네트워크 운영환경에서는 다양한 네트워크 장비로부터 실시간 정보를 안전하고 빠르게
수집할 필요가 있습니다. 수작업으로 장비에 접속하여 시리얼 넘버나 호스트 네임 같은
정보를 확인하는 방식은 비효율적이며, 오류 발생가능성도 높습니다. 이 실습은 Cisco IOS XE 기반 라우터로부터
RESTCONF API를 통해 핵심 정보를 자동으로 수집하고, Dictionary 형식으로 가독성 있게 출력하는
python script 입니다.  

### 시스템 동작 구조

1. 장비 인벤토리 관리
- get_inventory() 함수에서 관리 대상 장비 목록(호스트, 계정 정보)을 Python 딕셔너리로 정의

2. 장비 API 호출
- get_serial_data(), get_hostname() 함수에서 각 장비별 RESTCONF API 호출
- HTTP 헤더(Content-Type, Accept)를 YANG 데이터 JSON 형식으로 지정
- HTTPS 요청 시 SSL 인증서 검증 비활성화(개발 환경용)

3. 데이터 수집 및 가공
- 수집된 장비 정보를 structure_data() 함수에서 표준화

4. 결과 출력
- 최종적으로 main() 함수에서 장비별 호스트네임 및 시리얼 번호를 표 형태로 출력

### 실행결과

|  Device | Hostname  |  Serial Number  |  
|   r1 |  R1-Core    |  FXS123456AB  |  
|      r2  |      R2-Edge  | FXS987654CD  |   



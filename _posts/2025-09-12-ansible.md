

### Ansible 이란?

### Ansible 개념
- Infarastructure as Code
- Ansible은 Agentless IT 자동화 도구
- 서버 설정(Configuration Management), 애플리케이션 배포, 태스크 자동화, 오케스트레이션을 담당
- Python 기반, SSH 연결을 통해 원격 서버에 명령 실행

> Ansible은 여러개의 서버나 장치를 효율적으로 관리하기 위해 만들어진 환경 구성 자동화 도구 입니다

| 특징 | 설명 |
| -------- | ------- |
| Agentless | 대상 서버에 별도 소프트웨어 설치 불필요 |
| Push 기반 | Control Node에서 명령어 Push  |
| YAML 기반 | Playbook으로 선언적 관리  |
| Idempotent | 반복 실행해도 상태 변경이 없는 안전한 자동화 |
| 확장성 | 모듈 기반으로 다양한 OS/클라우드 지원 |

### Ansible 아키텍쳐

<img width="1280" height="1341" alt="image" src="https://github.com/user-attachments/assets/75d0752e-99cb-45cc-ad94-796482b78e18" />

[그림 1-1 Ansible 아키텍쳐1]

<img width="682" height="298" alt="image" src="https://github.com/user-attachments/assets/7bf2e16d-b210-44ed-9fca-b97f3bbcd6df" />

[그림 1-2 Ansible 아키텍쳐 2]


### 구성 요소

| 구성 요소 | 역할 |
| ------ | ------ |
| Control Node | Ansible 설치, Playbook/ Inventory 관리 |
| Management Node | SSH로 연결되는 서버, 에이전트 설치 필요 없음 |
| Inventory | 관리 대상 서버 목록, 그룹화 가능|
| Module | 서버에서 실제 작업 수행(ex: yum, apt, service, copy) |
| Playbook | 작업 순서 정의, YAML 형식으로 작성 |
| Role | Playbook 재사용 단위, 계층적 구조 제공 |

Controle Node: Ansible에 설치된 노드로써 Ansible 명령이 실행 가능한 도구
Management Node: Ansible로 관리할 노드로 python만 설치되어있으면 됨


![Bit Operations](https://velog.velcdn.com/images/baeyuna97/post/ad35c05c-9336-4526-9d1b-bcab875e258d/image.png)
[그림 1-3 Ansible 실행 구조]


### 메인 컨셉
1. Idempotency
   - 같은 Playbook을 여러번 실행해도 서버 상태가 불필요하게 변경되지 않음
2. Declarative 방식
   - "무엇을 원하는지"를 정의 -> Ansible이 어떻게 적용할지 결정
3. Push 방식
   - Control Node에서 Management Node로 명령을 Push
   - Agentless이기 때문에 SSH 또는 WinRM만 있으면 됨


### 주요 유즈케이스

| 유즈 케이스 | 설명 |
| ------ | ------ |
| 서버 구성 관리 | OS 설정, 패키지 설치, 사용자 계정 관리 |
| 애플리케이션 배포 | 웹서버, db, 컨테이너 배포 자동화 |
| 네트워크 자동화 | Cisco, Juniper 등 네트워크 장비 설정|
| 클라우드 인프라 프로비져닝 | AWS, Azure, GCP 인프라 생성/관리 |
| 모니터링 배포 | Prometheus, Grafana 설치 및 설정 |
| 반복 작업 자동화 | Cron, 시스템 유지 보수 등  |


### 자동화의 필요성
- IT 환경의 복잡성 증가
  - 서버 수, 애플리케이션, 네트워크 장비, 클라우드 인프라 증가
- 반복 작업의 한계
  - 수작업으로 서버 세팅, 패치, 배포 -> 오류 발생, 비효율
- 클라우드 환경까지 확장
  - AWS, GCP, Azure 등 수많은 인스턴스와 네트워크 구성
  - Iac(Infrastructure as Code) 필요 -> 반복적 배포, 확장성, 버전 관리

가령, 웹서버 100대가 있다면, SSH 접속 후 패키지 설치, 서비스 기동을 100번 반복해야 합니다.
클라우드 인스턴스 프로비져닝을 Terraform/Ansible로 코드하면 몇 분 만에 처리 

### 2. Agentless
- Agentless 특징
  - 대상 서버에 별도 에이전트 설치 불필요
  - SSH(Linux) / WinRM(Windows)만 있으면 동작
- 장점
  - 설치/관리 부담 최소화
  - 기존 서버 환경 변화 없이 사용 가능

### Ansible을 쓰는 이유
- 단순함: YAML 기반 플레이북 -> 사람이 읽기 쉬움
- Idempotency: 반복 실행해도 상태가 일정하게 유지
- 확장성: 서버, 네트워크 장비, 클라우드 모두 지원
- 커뮤니티와 모듈 풍부: 수천 개 모듈, 재사용 가능

use case 
- 서버 구성 관리: 패키지 설치, 사용자 계정 생성
- 애플리케이션 배포: Nginx, Docker, Node.js
- 클라우드 인프라 배포: AWS EC2, VPC, Security Group
- 네트워크 자동화: Cisco, Juniper, Arista 장비 설정

### 멱등성 (Idempotency)
- 정의: 같은 작업을 여러번 반복해도 최종 상태가 변하지 않음
- 장점
  - 안전한 반복 실행
  - 오류 시 재시도 가능
  - 일관된 서버 상태 유지
 
  ### Terraform과 비교
  
| 항목    | Ansible                   | Terraform                    |
| ----- | ------------------------- | ---------------------------- |
| 목적    | 구성 관리, 애플리케이션 배포, 오케스트레이션 | 인프라 프로비저닝(IaC)               |
| 방식    | Push, Agentless           | Push/Pull, Provider 기반       |
| 상태 관리 | 멱등성 플레이북                  | 상태 파일(State file)            |
| 적용 범위 | 서버, 네트워크, 클라우드, 애플리케이션    | 주로 클라우드 인프라 (VM, 네트워크, 스토리지) |
| 장점    | 구성 관리·배포·자동화 한번에 가능       | 클라우드 리소스 생성/삭제/관리 자동화        |

Terraform → 인프라(VPC, EC2, Subnet) 생성

Ansible → 인프라 위에서 서버/애플리케이션 구성 및 배포

#### 기본 명령어 Ad-hoc
```
# 모든 서버에 ping
ansible all -m ping

# 특정 그룹의 서버에서 패키지 설치
ansible webservers -m yum -a "name=httpd state=present"

# 서비스 시작
ansible webservers -m service -a "name=httpd state=started"

# 파일 복사
ansible all -m copy -a "src=/tmp/index.html dest=/var/www/html/index.html"

```

### Playbook 실행
```
# example_playbook.yml
- hosts: webservers
  become: yes
  tasks:
    - name: Install nginx
      apt:
        name: nginx
        state: present

    - name: Start nginx
      service:
        name: nginx
        state: started
```

```
# Playbook 실행
ansible-playbook example_playbook.yml
```

### Inventory 파일 예시
```
[webservers]
web1.example.com
web2.example.com

[dbservers]
db1.example.com

```
